<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="UTF-8">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="images/favicon.png" rel="shortcut icon">
    <script src="user.js" ></script>

    <title>Kardiy - Elegant - Fast - Reliable - Cheap</title>

    <!--====== Google Font ======-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet">

    <!--====== Vendor Css ======-->
    <link rel="stylesheet" href="css/vendor.css">

    <!--====== Utility-Spacing ======-->
    <link rel="stylesheet" href="css/utility.css">

    <!--====== App ======-->
    <link rel="stylesheet" href="css/app.css">
    <style>
      [data-index-loading] {
        font-size: 14px;
        letter-spacing: 0.02em;
      }

      .product-l__action {
        margin-top: 10px;
      }

      .product-l__action .btn {
        width: 100%;
        font-size: 12px;
        letter-spacing: 0.04em;
        padding: 10px 14px;
      }

      /* ---------- Top Rated Products slider ---------- */
      #testimonial-slider .top-rated-card {
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
        gap: 32px;
        padding: 34px 38px;
        border-radius: 26px;
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.95) 0%, #eef2ff 100%);
        box-shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
        position: relative;
        overflow: hidden;
        isolation: isolate;
      }

      #testimonial-slider .top-rated-card::before {
        content: '';
        position: absolute;
        inset: 12px;
        border-radius: 20px;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(99, 102, 241, 0.12));
        opacity: 0;
        transition: opacity 0.45s ease;
        z-index: -1;
      }

      #testimonial-slider .top-rated-card:hover::before {
        opacity: 1;
      }

      #testimonial-slider .top-rated-card__media {
        flex: 0 0 220px;
        max-width: 220px;
        border-radius: 20px;
        overflow: hidden;
        background: #0f172a;
        position: relative;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
        aspect-ratio: 4 / 5;
      }

      #testimonial-slider .top-rated-card__media::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(180deg, rgba(15, 23, 42, 0) 20%, rgba(15, 23, 42, 0.25) 100%);
        opacity: 0;
        transition: opacity 0.45s ease;
      }

      #testimonial-slider .top-rated-card__media:hover::after {
        opacity: 1;
      }

      #testimonial-slider .top-rated-card__media .testimonial__img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0;
        transform: scale(1.01);
        transition: transform 0.6s ease;
      }

      #testimonial-slider .top-rated-card__media:hover .testimonial__img {
        transform: scale(1.08);
      }

      #testimonial-slider .top-rated-card__body {
        flex: 1;
        min-width: 260px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      #testimonial-slider .top-rated-card__rating {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
        color: #0f172a;
      }

      #testimonial-slider .top-rated-card__stars {
        display: inline-flex;
        gap: 6px;
        color: #f59e0b;
        font-size: 1.05rem;
      }

      #testimonial-slider .top-rated-card__stars i {
        margin-right: 0;
      }

      #testimonial-slider .top-rated-card__score {
        font-size: 1.45rem;
      }

      #testimonial-slider .top-rated-card__count {
        color: #64748b;
        font-size: 0.95rem;
      }

      #testimonial-slider .top-rated-card__title {
        margin: 0;
        font-size: 1.45rem;
        font-weight: 600;
        color: #0f172a;
        letter-spacing: 0.01em;
      }

      #testimonial-slider .top-rated-card__quote {
        position: relative;
        padding-left: 36px;
        font-size: 1.02rem;
        line-height: 1.7;
        color: #334155;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      #testimonial-slider .top-rated-card__quote::before {
        content: '\201C';
        position: absolute;
        left: 0;
        top: -6px;
        font-size: 3rem;
        color: rgba(59, 130, 246, 0.25);
      }

      #testimonial-slider .top-rated-card__author {
        font-weight: 600;
        color: #475569;
        letter-spacing: 0.01em;
      }

      #testimonial-slider .top-rated-card__cta {
        margin-top: auto;
      }

      #testimonial-slider .top-rated-card__cta .btn {
        padding: 10px 20px;
        border-radius: 999px;
        font-size: 0.95rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        box-shadow: 0 15px 30px rgba(59, 130, 246, 0.2);
      }

      #testimonial-slider .top-rated-card__cta .btn:hover {
        box-shadow: 0 18px 38px rgba(59, 130, 246, 0.25);
      }

      #testimonial-slider .owl-dots {
        margin-top: 30px;
      }

      #testimonial-slider .owl-dot span {
        background: rgba(148, 163, 184, 0.45);
        transition: background 0.3s ease;
      }

      #testimonial-slider .owl-dot.active span {
        background: #3b82f6;
      }

      @media (max-width: 991px) {
        #testimonial-slider .top-rated-card {
          padding: 28px;
          gap: 24px;
        }

        #testimonial-slider .top-rated-card__media {
          flex-basis: 100%;
          max-width: 100%;
          aspect-ratio: 3 / 2;
        }
      }

      @media (max-width: 575px) {
        #testimonial-slider .top-rated-card {
          padding: 24px 22px;
        }

        #testimonial-slider .top-rated-card__rating {
          flex-wrap: wrap;
        }
      }
    </style>
</head>
<body class="config">
    <div class="preloader is-active">
        <div class="preloader__wrap">

            <img class="preloader__img" src="images/preloader.png" alt=""></div>
    </div>

    <!--====== Main App ======-->
    <div id="app">

        <!--====== Main Header ======-->
       <div id="header-placeholder"></div>
    <script>
    const INDEX_ADD_TO_CART_URL = `${API_ROOT}/users/add-to-cart`;

    const indexGetUserSafe = () => {
      try { return (typeof getCurrentUser === 'function') ? getCurrentUser() : null; }
      catch (_) { return null; }
    };

    async function indexAddToCart(productId, user) {
      if (!productId || !user) {
        throw new Error('Missing product or user information');
      }
      const payload = {
        product_id: productId,
        product_amount: 1,
        options: {},
        user_id: user.user_id,
        user_email: user.user_email
      };

      const res = await fetch(INDEX_ADD_TO_CART_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error(`Add to cart failed (${res.status})`);
      const updatedUser = await res.json().catch(() => null);
      if (updatedUser && typeof setCurrentUser === 'function') {
        setCurrentUser(updatedUser);
      } else if (typeof window.checkSession === 'function') {
        await window.checkSession();
      }
    }

    document.addEventListener('click', async (event) => {
      const btn = event.target.closest('.js-index-add-to-cart');
      if (!btn) return;
      event.preventDefault();
      const productId = btn.dataset.productId;
      if (!productId) return;

      const user = indexGetUserSafe();
      if (!user) {
        window.location.href = 'signin.html';
        return;
      }

      if (btn.dataset.busy === '1') return;
      const originalHtml = btn.innerHTML;
      const originalTitle = btn.getAttribute('title') || '';
      btn.dataset.busy = '1';
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      btn.setAttribute('title', 'Adding...');

      try {
        await indexAddToCart(productId, user);
        btn.innerHTML = '<i class="fas fa-check"></i>';
        btn.setAttribute('title', 'Added to cart');
        setTimeout(() => {
          btn.innerHTML = originalHtml;
          btn.setAttribute('title', originalTitle);
        }, 900);
      } catch (err) {
        console.error('[index-add-to-cart]', err);
        showToast('We couldn\'t add that item to your cart. Please try again.', { type: 'error' });
        btn.innerHTML = originalHtml;
        btn.setAttribute('title', originalTitle);
      } finally {
        delete btn.dataset.busy;
      }
    });

    (async () => {
        const el = document.getElementById('header-placeholder');
        const resp = await fetch('top_bar.html?_=' + Date.now()); // bust cache
        const html = await resp.text();
        el.innerHTML = html;

        await window.checkSession();

        document.dispatchEvent(new CustomEvent('user:changed'));
    
        el.querySelectorAll('script').forEach((old) => {
            const s = document.createElement('script');
            if (old.src) {
            s.src = old.src; s.async = old.async; s.defer = old.defer || false;
            } else {
            s.textContent = old.textContent;
            }
            document.head.appendChild(s);
        });

        // Call menu builder with already-fetched products if we have them
        const tryInit = () => {
            if (typeof window.initHeaderMenu === 'function') {
            window.initHeaderMenu(window.__ALL_PRODUCTS__ || null);
            }
        };
        // tiny delay to ensure the function is defined
        setTimeout(tryInit, 0);
        })();
        </script>
        <!--====== End - Main Header ======-->


        <!--====== App Content ======-->
        <div class="app-content">

            <!--====== Primary Slider ======-->
            <div class="s-skeleton s-skeleton--h-600 s-skeleton--bg-grey">
                <div class="owl-carousel primary-style-1" id="hero-slider">
                    <div class="hero-slide hero-slide--1">
                        <div class="container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="slider-content slider-content--animation">
<!-- 
                                        <span class="content-span-1 u-c-white">Find Top Selling Sites</span>

                                        <span class="content-span-2 u-c-white">30% Off On Websites</span>

                                        <span class="content-span-3 u-c-white">Find your Style, Run Your Business</span> -->
                                <span class="content-span-4 u-c-white" data-text-key="heroMain">Starting At
                                    <span class="u-c-brand">$209.99</span>
                                </span>
                                <a class="shop-now-link btn--e-brand" href="shop-side-version-2.html" data-text-key="heroButton">SHOP NOW</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-slide hero-slide--2">
                        <div class="container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="slider-content slider-content--animation">

                                        <!-- <span class="content-span-1 u-c-white">Find Top Selling Sites</span>

                                        <span class="content-span-2 u-c-white">30% Off On Websites</span>

                                        <span class="content-span-3 u-c-white">Find your Style, Run Your Business</span> -->

                                <span class="content-span-4 u-c-white" data-text-key="heroMain">Starting At
                                    <span class="u-c-brand">$209.99</span>
                                </span>
                                <a class="shop-now-link btn--e-brand" href="shop-side-version-2.html" data-text-key="heroButton">SHOP NOW</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-slide hero-slide--3">
                        <div class="container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="slider-content slider-content--animation">

                                        <!-- <span class="content-span-1 u-c-white">Find Top Selling Sites</span>

                                        <span class="content-span-2 u-c-white">30% Off On Websites</span>

                                        <span class="content-span-3 u-c-white">Find your Style, Run Your Business</span> -->

                            <span class="content-span-4 u-c-white" data-text-key="heroMain">Starting At
                                <span class="u-c-brand">$209.99</span>
                            </span>
                            <a class="shop-now-link btn--e-brand" href="shop-side-version-2.html" data-text-key="heroButton">SHOP NOW</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Primary Slider ======-->


            <!--====== Section 1 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Intro ======-->
                <div class="section__intro u-s-m-b-46">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="section__text-wrap">
                                <h1 class="section__heading u-c-secondary u-s-m-b-12" data-text-key="dealsTitle">SHOP BY DEALS</h1>
                                <span class="section__span u-c-silver" data-text-key="dealsSubtitle">BROWSE FAVOURITE DEALS</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Intro ======-->


                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-5 col-md-5 u-s-m-b-30">

                                <a class="collection" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--square">

                                        <img class="aspect__img collection__img" src="" alt="" data-id="coll-1"></div>
                                </a></div>
                            <div class="col-lg-7 col-md-7 u-s-m-b-30">

                                <a class="collection" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--1286-890">

                                        <img class="aspect__img collection__img" src="" alt="" data-id="coll-2"></div>
                                </a></div>
                            <div class="col-lg-7 col-md-7 u-s-m-b-30">

                                <a class="collection" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--1286-890">

                                        <img class="aspect__img collection__img" src="" alt="" data-id="coll-3"></div>
                                </a></div>
                            <div class="col-lg-5 col-md-5 u-s-m-b-30">

                                <a class="collection" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--square">

                                        <img class="aspect__img collection__img" src="" alt="" data-id="coll-4"></div>
                                </a></div>
                        </div>
                    </div>
                </div>

                <!--====== Section Content ======-->
            </div>
            <!--====== End - Section 1 ======-->




            <!--====== Section 5 ======-->
            <div class="banner-bg">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="banner-bg__countdown">
                                    <div class="countdown countdown--style-banner" data-countdown="2020/05/01"></div>
                                </div>
                                <div class="banner-bg__wrap">
                                    <div data-text-key="globalOffers"> <div class="banner-bg__text-1">
                                            <span class="u-c-white">Global</span>
                                            <span class="u-c-secondary">Offers</span>
                                        </div>
                                        <div class="banner-bg__text-2">
                                            <span class="u-c-secondary">Official Launch</span>
                                            <span class="u-c-white">Don't Miss!</span>
                                        </div>
                                        <span class="banner-bg__text-block banner-bg__text-3 u-c-secondary">Enjoy Free Shipping when you buy 2 items and above!</span>
                                    </div>
                                    <a class="banner-bg__shop-now btn--e-secondary" href="shop-side-version-2.html" data-text-key="globalOffersButton">Shop Now</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 5 ======-->


            <!--====== Section 6 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Intro ======-->
                <div class="section__intro u-s-m-b-46">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="section__text-wrap">
                                    <h1 class="section__heading u-c-secondary u-s-m-b-12">FEATURED PRODUCTS</h1>

                                    <span class="section__span u-c-silver">FIND NEW FEATURED PRODUCTS</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Intro ======-->


                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row" id="featured-products-row">
                            <div class="col-12">
                                <div class="u-s-m-b-30" data-index-loading="featured" style="text-align:center; color:#64748b;">
                                    Loading featured products...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 6 ======-->


            <!--====== Section 7 ======-->
            <div class="u-s-p-b-60">

                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">

                                <a class="promotion" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--square">
                                        <img class="aspect__img promotion__img" src="" alt="" data-id="promo-1" ></div>
                                    <div class="promotion__content">
                                        <div class="promotion__text-wrap">
                                            <div class="promotion__text-1">
                                                <span class="u-c-secondary" data-text-key="promo1Line1">WEBSITES FOR YOUR BUSINESS</span></div>
                                            <div class="promotion__text-2">
                                                <span class="u-c-secondary" data-text-key="promo1Line2a">GET IN</span>
                                                <span class="u-c-brand" data-text-key="promo1Line2b">TOUCH</span></div>
                                        </div>
                                    </div>
                                </a></div>
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">

                                <a class="promotion" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--square">
                                        <img class="aspect__img promotion__img" src="" alt="" data-id="promo-2"></div>
                                    <div class="promotion__content">
                                        <div class="promotion__text-wrap">
                                            <div class="promotion__text-1">
                                                <span class="u-c-secondary" data-text-key="promo2Line1a">E-COMMERCE</span>
                                                <span class="u-c-brand" data-text-key="promo2Line1b">2025</span></div>
                                            <div class="promotion__text-2">
                                                <span class="u-c-secondary" data-text-key="promo2Line2">CREATE YOUR STORE</span></div>
                                        </div>
                                    </div>
                                </a></div>
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">

                                <a class="promotion" href="shop-side-version-2.html">
                                    <div class="aspect aspect--bg-grey aspect--square">
                                        <img class="aspect__img promotion__img" src="" alt="" data-id="promo-3"></div>
                                    <div class="promotion__content">
                                        <div class="promotion__text-wrap">
                                            <div class="promotion__text-1">
                                                <span class="u-c-secondary" data-text-key="promo3Line1">BUY IT NOW</span></div>
                                            <div class="promotion__text-2">
                                                <span class="u-c-brand" data-text-key="promo3Line2">GET UP TO 30% OFF</span></div>
                                        </div>
                                    </div>
                                </a></div>
                        </div>
                    </div>
                </div>
                </div>
            <!--====== End - Section 7 ======-->


            <!--====== Section 8 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4 col-md-6 col-sm-6 u-s-m-b-30">
                                <div class="column-product">

                                    <span class="column-product__title u-c-secondary u-s-m-b-25">SPECIAL PRODUCTS</span>
                                    <ul class="column-product__list" id="special-products-list">
                                        <li class="column-product__item" data-index-loading="special"><div class="product-l" style="justify-content:center; color:#64748b;">Loading special products...</div></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-6 u-s-m-b-30">
                                <div class="column-product">

                                    <span class="column-product__title u-c-secondary u-s-m-b-25">WEEKLY PRODUCTS</span>
                                    <ul class="column-product__list" id="weekly-products-list">
                                        <li class="column-product__item" data-index-loading="weekly"><div class="product-l" style="justify-content:center; color:#64748b;">Loading weekly picks...</div></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 col-sm-6 u-s-m-b-30">
                                <div class="column-product">

                                    <span class="column-product__title u-c-secondary u-s-m-b-25">FLASH PRODUCTS</span>
                                    <ul class="column-product__list" id="flash-products-list">
                                        <li class="column-product__item" data-index-loading="flash"><div class="product-l" style="justify-content:center; color:#64748b;">Loading flash deals...</div></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 8 ======-->


            <!--====== Section 9 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4 col-md-6 u-s-m-b-30">
                            <div class="service u-h-100">
                                <div class="service__icon"><i class="fas fa-truck"></i></div>
                                <div class="service__info-wrap">
                                    <span class="service__info-text-1" data-text-key="service1Title">Free Shipping</span>
                                    <span class="service__info-text-2" data-text-key="service1Desc">Free shipping on all US order or order above $200</span>
                                </div>
                            </div>
                            </div>
                            <div class="col-lg-4 col-md-6 u-s-m-b-30">
                                <div class="service u-h-100">
                                    <div class="service__icon"><i class="fas fa-redo"></i></div>
                                    <div class="service__info-wrap">

                                        <span class="service__info-text-1" data-text-key="service2Title">Shop with Confidence</span>

                                        <span class="service__info-text-2" data-text-key="service2Desc">Our Protection covers your purchase from click to delivery</span></div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-6 u-s-m-b-30">
                                <div class="service u-h-100">
                                    <div class="service__icon"><i class="fas fa-headphones-alt"></i></div>
                                    <div class="service__info-wrap">

                                        <span class="service__info-text-1" data-text-key="service3Title">24/7 Help Center</span>

                                        <span class="service__info-text-2" data-text-key="service3Desc">Round-the-clock assistance for a smooth shopping experience</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 9 ======-->


            <!--====== Section 10 ======-->

            <!--====== End - Section 10 ======-->


            <!--====== Section 11 ======-->
            <div class="u-s-p-b-90 u-s-m-b-30">

                <div class="section__intro u-s-m-b-46">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="section__text-wrap">
                                    <h1 class="section__heading u-c-secondary u-s-m-b-12">TOP RATED PRODUCTS</h1>
                                    <span class="section__span u-c-silver">WHAT OUR CLIENTS SAY</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section__content">
                    <div class="container">
                        <div class="slider-fouc">
                            <div class="owl-carousel" id="testimonial-slider">
                                <div class="testimonial">
                                    <p>Loading top reviews...</p>
                                </div>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
            <!--====== End - Section 11 ======-->


            <!--====== Section 12 ======-->

            <!--====== End - Section 12 ======-->
        </div>
        <!--====== End - App Content ======-->


        <!--====== Main Footer ======-->
        <div id="footer-placeholder"></div>
        <script>
        (async () => {
            const el = document.getElementById('footer-placeholder');
            const resp = await fetch('footer.html?_=' + Date.now()); // Fetch footer.html
            const html = await resp.text();
            el.innerHTML = html;
        })();
        </script>
        </div>

        <!--====== Modal Section ======-->


        <!--====== Quick Look Modal ======-->
        <div class="modal fade" id="quick-look">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content modal--shadow">

                    <button class="btn dismiss-button fas fa-times" type="button" data-dismiss="modal"></button>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-5">

                                <!--====== Product Breadcrumb ======-->
                                <div class="pd-breadcrumb u-s-m-b-30">
                                    <ul class="pd-breadcrumb__list">
                                        <li class="has-separator">

                                            <a href="index.hml">Home</a></li>
                                        <li class="has-separator">

                                            <a href="shop-side-version-2.html">Electronics</a></li>
                                        <li class="has-separator">

                                            <a href="shop-side-version-2.html">DSLR Cameras</a></li>
                                        <li class="is-marked">

                                            <a href="shop-side-version-2.html">Nikon Cameras</a></li>
                                    </ul>
                                </div>
                                <!--====== End - Product Breadcrumb ======-->


                                <!--====== Product Detail ======-->
                                <div class="pd u-s-m-b-30">
                                    <div class="pd-wrap">
                                        <div id="js-product-detail-modal">
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                        </div>
                                    </div>
                                    <div class="u-s-m-t-15">
                                        <div id="js-product-detail-modal-thumbnail">
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                            <div>

                                                <img class="u-img-fluid" src="" alt=""></div>
                                        </div>
                                    </div>
                                </div>
                                <!--====== End - Product Detail ======-->
                            </div>
                            <div class="col-lg-7">

                                <!--====== Product Right Side Details ======-->
                                <div class="pd-detail">
                                    <div>

                                        <span class="pd-detail__name">Nikon Camera 4k Lens Zoom Pro</span></div>
                                    <div>
                                        <div class="pd-detail__inline">

                                            <span class="pd-detail__price">$6.99</span>

                                            <span class="pd-detail__discount">(76% OFF)</span><del class="pd-detail__del">$28.97</del></div>
                                    </div>
                                    <div class="u-s-m-b-15">
                                        <div class="pd-detail__rating gl-rating-style"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>

                                            <span class="pd-detail__review u-s-m-l-4">

                                                <a href="product-detail.html">23 Reviews</a></span></div>
                                    </div>
                                    <div class="u-s-m-b-15">
                                        <div class="pd-detail__inline">

                                            <span class="pd-detail__stock">200 in stock</span>

                                            <span class="pd-detail__left">Only 2 left</span></div>
                                    </div>
                                    <div class="u-s-m-b-15">

                                        <span class="pd-detail__preview-desc">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.</span></div>
                                    <div class="u-s-m-b-15">
                                        <div class="pd-detail__inline">

                                            <span class="pd-detail__click-wrap"><i class="far fa-heart u-s-m-r-6"></i>
                                                <span>Add to Wishlist</span>
                                                <span class="pd-detail__click-count">(222)</span></span></div>
                                    </div>
                                    <div class="u-s-m-b-15">
                                        <div class="pd-detail__inline">

                                            <span class="pd-detail__click-wrap"><i class="far fa-envelope u-s-m-r-6"></i>

                                                <span>Email me When the price drops</span>

                                                <span class="pd-detail__click-count">(20)</span></span></div>
                                    </div>
                                    <div class="u-s-m-b-15">
                                        <ul class="pd-social-list">
                                            <li>

                                                <a class="s-fb--color-hover" href="#"><i class="fab fa-facebook-f"></i></a></li>
                                            <li>

                                                <a class="s-tw--color-hover" href="#"><i class="fab fa-twitter"></i></a></li>
                                            <li>

                                                <a class="s-insta--color-hover" href="#"><i class="fab fa-instagram"></i></a></li>
                                            <li>

                                                <a class="s-wa--color-hover" href="#"><i class="fab fa-whatsapp"></i></a></li>
                                            <li>

                                                <a class="s-gplus--color-hover" href="#"><i class="fab fa-google-plus-g"></i></a></li>
                                        </ul>
                                    </div>
                                    <div class="u-s-m-b-15">
                                        <form class="pd-detail__form">
                                            <div class="pd-detail-inline-2">
                                                <div class="u-s-m-b-15">

                                                    <!--====== Input Counter ======-->
                                                    <div class="input-counter">

                                                        <span class="input-counter__minus fas fa-minus"></span>

                                                        <input class="input-counter__text input-counter--text-primary-style" type="text" value="1" data-min="1" data-max="1000">

                                                        <span class="input-counter__plus fas fa-plus"></span></div>
                                                    <!--====== End - Input Counter ======-->
                                                </div>
                                                <div class="u-s-m-b-15">

                                                    <button class="btn btn--e-brand-b-2" type="submit">Add to Cart</button></div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="u-s-m-b-15">

                                        <span class="pd-detail__label u-s-m-b-8">Product Policy:</span>
                                        <ul class="pd-detail__policy-list">
                                            <li><i class="fas fa-check-circle u-s-m-r-8"></i>

                                                <span>Buyer Protection.</span></li>
                                            <li><i class="fas fa-check-circle u-s-m-r-8"></i>

                                                <span>Full Refund if you don't receive your order.</span></li>
                                            <li><i class="fas fa-check-circle u-s-m-r-8"></i>

                                                <span>Returns accepted if product not as described.</span></li>
                                        </ul>
                                    </div>
                                </div>
                                <!--====== End - Product Right Side Details ======-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Quick Look Modal ======-->


        <!--====== Add to Cart Modal ======-->
        <div class="modal fade" id="add-to-cart">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content modal-radius modal-shadow">

                    <button class="btn dismiss-button fas fa-times" type="button" data-dismiss="modal"></button>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-6 col-md-12">
                                <div class="success u-s-m-b-30">
                                    <div class="success__text-wrap"><i class="fas fa-check"></i>

                                        <span>Item is added successfully!</span></div>
                                    <div class="success__img-wrap">

                                        <img class="u-img-fluid" src="" alt=""></div>
                                    <div class="success__info-wrap">

                                        <span class="success__name">Beats Bomb Wireless Headphone</span>

                                        <span class="success__quantity">Quantity: 1</span>

                                        <span class="success__price">$170.00</span></div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12">
                                <div class="s-option">

                                    <span class="s-option__text">1 item (s) in your cart</span>
                                    <div class="s-option__link-box">

                                        <a class="s-option__link btn--e-white-brand-shadow" data-dismiss="modal">CONTINUE SHOPPING</a>

                                        <a class="s-option__link btn--e-white-brand-shadow" href="cart.html">VIEW CART</a>

                                        <a class="s-option__link btn--e-brand-shadow" href="checkout.html">PROCEED TO CHECKOUT</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Add to Cart Modal ======-->


        <!--====== Newsletter Subscribe Modal ======-->
        <!-- <div class="modal fade new-l" id="newsletter-modal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content modal--shadow">

                    <button class="btn new-l__dismiss fas fa-times" type="button" data-dismiss="modal"></button>
                    <div class="modal-body">
                        <div class="row u-s-m-x-0">
                            <div class="col-lg-6 new-l__col-1 u-s-p-x-0">

                                <a class="new-l__img-wrap u-d-block" href="shop-side-version-2.html">

                                    <img class="u-img-fluid u-d-block" src="images/newsletter/newsletter.jpg" alt=""></a></div>
                            <div class="col-lg-6 new-l__col-2">
                                <div class="new-l__section u-s-m-t-30">
                                    <div class="u-s-m-b-8 new-l--center">
                                        <h3 class="new-l__h3">Newsletter</h3>
                                    </div>
                                    <div class="u-s-m-b-30 new-l--center">
                                        <p class="new-l__p1">Sign up for emails to get the scoop on new arrivals, special sales and more.</p>
                                    </div>
                                    <form class="new-l__form">
                                        <div class="u-s-m-b-15">

                                            <input class="news-l__input" type="text" placeholder="E-mail Address"></div>
                                        <div class="u-s-m-b-15">

                                            <button class="btn btn--e-brand-b-2" type="submit">Sign up!</button></div>
                                    </form>
                                    <div class="u-s-m-b-15 new-l--center">
                                        <p class="new-l__p2">By Signing up, you agree to receive Reshop offers,<br />promotions and other commercial messages. You may unsubscribe at any time.</p>
                                    </div>
                                    <div class="u-s-m-b-15 new-l--center">

                                        <a class="new-l__link" data-dismiss="modal">No Thanks</a></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <!--====== End - Newsletter Subscribe Modal ======-->
        <!--====== End - Modal Section ======-->
    </div>
    <!--====== End - Main App ======-->


    <!--====== Google Analytics: change UA-XXXXX-Y to be your site's ID ======-->
    <script>
        window.ga = function() {
            ga.q.push(arguments)
        };
        ga.q = [];
        ga.l = +new Date;
        ga('create', 'UA-XXXXX-Y', 'auto');
        ga('send', 'pageview')
    </script>
    <script src="https://www.google-analytics.com/analytics.js" async defer></script>

    <!--====== Vendor Js ======-->
    <script src="js/vendor.js"></script>

    <!--====== jQuery Shopnav plugin ======-->
    <script src="js/jquery.shopnav.js"></script>

    <!--====== App ======-->
    <script src="js/app.js"></script>

    <!--====== Noscript ======-->
    <noscript>
        <div class="app-setting">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="app-setting__wrap">
                            <h1 class="app-setting__h1">JavaScript is disabled in your browser.</h1>

                            <span class="app-setting__text">Please enable JavaScript in your browser or upgrade to a JavaScript-capable browser.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </noscript>
    
    <!--====== Dynamic Sections Script ======-->
    <script>
    async function populateDynamicSections() {

      const IMAGE_FALLBACK = '';
      const fmtMoney = n => Number(n||0).toLocaleString('en-US', {style:'currency', currency:'USD'});

      const getId = p => p?.product_id ?? p?.rowid ?? p?.id;

      function imageURL(p) {
        try {
          let path = '';
          const v = p.product_image_path;
          if (!v) return IMAGE_FALLBACK;
          if (typeof v === 'string') {
            try { const arr = JSON.parse(v); if (Array.isArray(arr) && arr.length) path = arr[0]; }
            catch { path = v; }
          } else if (Array.isArray(v) && v.length) path = v[0];
          if (!path) return IMAGE_FALLBACK;
          if (/^https?:\/\//i.test(path)) {
            return path;
          }
          return `${API_HOST}/${String(path).replace(/^\/+/, '')}`;
        } catch { return IMAGE_FALLBACK; }
      }

      function productLink(p) {
        const img = encodeURIComponent(imageURL(p));
        return `product-detail-variable.html?product_id=${encodeURIComponent(getId(p))}&image=${img}`;
      }

      let products = window.__ALL_PRODUCTS__ || [];
      if (!products.length) {
        try {
          const res = await fetch(`${API_ROOT}/products`);
          if (!res.ok) throw new Error('HTTP ' + res.status);
          products = await res.json();
          window.__ALL_PRODUCTS__ = products;
        } catch (e) {
          console.error('Failed to load products for sections:', e);
          return;
        }
      }

      document.querySelectorAll('[data-index-loading]').forEach(el => el.remove());

      function sortProducts(list) {
        return list.slice().sort((a, b) => (Number(a.product_index) || 0) - (Number(b.product_index) || 0) || String(a.product_name || '').localeCompare(String(b.product_name || '')));
      }

      // Render for featured (grid style)
      function renderFeatured(p) {
        const price = Number(p.product_price) || 0;
        const disc = Number(p.product_discount) || 0;
        const finalPrice = disc > 0 ? price * (1 - disc/100) : price;
        const discHTML = disc > 0 ? `<span class="product-o__discount">${fmtMoney(price)}</span>` : '';
        const category = p.product_tree1 || 'Electronics';
        const name = p.product_name || 'Product';

        return `
          <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 u-s-m-b-30">
            <div class="product-o product-o--hover-on u-h-100">
              <div class="product-o__wrap">
                <a class="aspect aspect--bg-grey aspect--square u-d-block" href="${productLink(p)}">
                  <img class="aspect__img" src="${imageURL(p)}" alt="${name}">
                </a>
                <div class="product-o__action-wrap">
                  <ul class="product-o__action-list">
                    <li><a class="js-index-add-to-cart" href="#" data-product-id="${getId(p)}" data-tooltip="tooltip" data-placement="top" title="Add to Cart"><i class="fas fa-cart-plus"></i></a></li>
                    <li><a href="${productLink(p)}" data-tooltip="tooltip" data-placement="top" title="View Details"><i class="fas fa-info-circle"></i></a></li>
                  </ul>
                </div>
              </div>
              <span class="product-o__category"><a href="shop-side-version-2.html">${category}</a></span>
              <span class="product-o__name"><a href="${productLink(p)}">${name}</a></span>
              <div class="product-o__rating gl-rating-style"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i><span class="product-o__review">(23)</span></div>
              <span class="product-o__price">${fmtMoney(finalPrice)} ${discHTML}</span>
            </div>
          </div>
        `;
      }

      // Render for column lists (special, weekly, flash)
      function renderColumn(p, sectionKey) {
        const price = Number(p.product_price) || 0;
        const disc = Number(p.product_discount) || 0;
        const finalPrice = disc > 0 ? fmtMoney(price * (1 - disc/100)) : fmtMoney(price);
        const discHTML = disc > 0 ? `<span class="product-l__discount">${fmtMoney(price)}</span>` : '';
        const category = p.product_tree1 || 'Electronics';
        const name = p.product_name || 'Product';
        const ratingHTML = sectionKey === 'flash products' ? '<div class="product-l__rating gl-rating-style"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i></div>' : '';

        return `
          <li class="column-product__item">
            <div class="product-l">
              <div class="product-l__img-wrap">
                <a class="aspect aspect--bg-grey aspect--square u-d-block product-l__link" href="${productLink(p)}">
                  <img class="aspect__img" src="${imageURL(p)}" alt="${name}">
                </a>
              </div>
              <div class="product-l__info-wrap">
                ${ratingHTML}
                <span class="product-l__category"><a href="shop-side-version-2.html">${category}</a></span>
                <span class="product-l__name"><a href="${productLink(p)}">${name}</a></span>
                <span class="product-l__price">${finalPrice} ${discHTML}</span>
                <div class="product-l__action">
                  <a class="btn btn--e-brand-b-2 js-index-add-to-cart" href="#" data-product-id="${getId(p)}">Add to Cart</a>
                </div>
              </div>
            </div>
          </li>
        `;
      }

      const sections = [
        { key: 'featured products', limit: 4, container: '#featured-products-row', render: renderFeatured },
        { key: 'special products', limit: 3, container: '#special-products-list', render: renderColumn },
        { key: 'weekly products', limit: 3, container: '#weekly-products-list', render: renderColumn },
        { key: 'flash products', limit: 3, container: '#flash-products-list', render: renderColumn }
      ];

      sections.forEach(sec => {
        const filtered = products.filter(p => (p.product_special_description || '').toLowerCase() === sec.key.toLowerCase());
        if (filtered.length) {
          const sorted = sortProducts(filtered).slice(0, sec.limit);
          const html = sorted.map(p => sec.render(p, sec.key)).join('');
          const cont = document.querySelector(sec.container);
          if (cont) cont.innerHTML = html;
        }
      });
    }

    document.addEventListener('DOMContentLoaded', populateDynamicSections);
    </script>
<script>
    (async () => {
        function setImage(selector, path, fallback, isBackground = false) {
            // Find ALL elements that match (originals and clones)
            const elements = document.querySelectorAll(selector);
            
            // Loop through each found element and apply the style
            elements.forEach(element => {
            let imageUrl = fallback; // Default to the fallback
            if (path) {
                // If the path is a full URL, use it directly. Otherwise, build it.
                imageUrl = path.startsWith('http') ? path : `${window.API_HOST}/${path}`;
            }

                if (isBackground) {
                    element.style.backgroundImage = `url('${imageUrl}')`;
                } else {
                    element.src = imageUrl;
                }
            });
        }

        try {
            const res = await fetch(`${window.API_ROOT}/brand`);
            if (!res.ok) return;
            const brandData = await res.json();
            
            const imagePaths = brandData.brand_nonProductImagePath || {};

            // --- Update Images on the Page ---

            // Hero Slider Backgrounds
            setImage('.hero-slide--1', imagePaths.hero1, '', true);
            setImage('.hero-slide--2', imagePaths.hero2, '', true);
            setImage('.hero-slide--3', imagePaths.hero3, '', true);

            // Collection "Shop by Deals" Images
            setImage('.collection__img[data-id="coll-1"]', imagePaths.coll1, '');
            setImage('.collection__img[data-id="coll-2"]', imagePaths.coll2, '');
            setImage('.collection__img[data-id="coll-3"]', imagePaths.coll3, '');
            setImage('.collection__img[data-id="coll-4"]', imagePaths.coll4, '');

            setImage('.banner-bg', imagePaths.globalOffers, '', true);

            // Promotion Section Images
            setImage('.promotion__img[data-id="promo-1"]', imagePaths.promo1, '');
            setImage('.promotion__img[data-id="promo-2"]', imagePaths.promo2, '');
            setImage('.promotion__img[data-id="promo-3"]', imagePaths.promo3, '');
            const slider = $('#hero-slider');
            
            // First, destroy the old, incorrectly sized slider instance
            slider.trigger('destroy.owl.carousel');
            
            // Second, re-initialize it. Now it will measure correctly.
            slider.owlCarousel({
                items: 1,
                loop: true,
                margin: 0,
                nav: false,
                dots: true,
                autoplay: true,
                autoplayTimeout: 5000,
                autoplayHoverPause: true
            });
        } catch (error) {
            console.error("Failed to load dynamic site images:", error);
            showGlobalError("We're having trouble loading the site content. Please refresh the page.");
        }
    })();
</script>
<script>

async function waitForProducts(maxMs = 5000) {
    const start = Date.now();
    while ((!window.__ALL_PRODUCTS__ || !window.__ALL_PRODUCTS__.length) &&
         Date.now() - start < maxMs){
            await new Promise(resolve => setTimeout(resolve, 200) );
    }
    return window.__ALL_PRODUCTS__ && window.__ALL_PRODUCTS__.length;
    
}

async function populateTopRatedProducts() {
    // This helper function mimics the logic from your product page for consistency.
    const getReviewStats = (reviews) => {
        const list = reviews || [];
        const count = list.length;
        const avg = count > 0
            ? list.reduce((s, r) => s + (Number(r.star) || 0), 0) / count
            : 0;
        return { list, count, avg };
    };

    const createStars = (rating) => {
        rating = Number(rating) || 0;
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5 ? 1 : 0;
        const emptyStars = 5 - fullStars - halfStar;
        let markup = '';
        for (let i = 0; i < fullStars; i++) markup += '<i class="fas fa-star"></i>';
        if (halfStar) markup += '<i class="fas fa-star-half-alt"></i>';
        for (let i = 0; i < emptyStars; i++) markup += '<i class="far fa-star"></i>';
        return markup;
    };

    const getImageUrl = (p) => {
        const IMAGE_FALLBACK = '';
        try {
            const raw = p?.product_image_path;
            let primary = '';

            if (!raw) return IMAGE_FALLBACK;

            if (Array.isArray(raw) && raw.length) {
                primary = raw[0];
            } else if (typeof raw === 'string') {
                try {
                    const parsed = JSON.parse(raw);
                    if (Array.isArray(parsed) && parsed.length) {
                        primary = parsed[0];
                    } else {
                        primary = raw;
                    }
                } catch {
                    primary = raw;
                }
            }

            if (!primary) return IMAGE_FALLBACK;

            if (/^https?:\/\//i.test(primary)) {
                return primary;
            }

            const normalised = String(primary).replace(/^\/+/, '');
            return `${API_HOST}/${normalised}`;
        } catch {
            return IMAGE_FALLBACK;
        }
    };

    // 1. Fetch Products and Reviews
    if (!await waitForProducts()) {
    console.error('Products not found on window object. Cannot populate reviews section.');
    document.querySelector('#testimonial-slider').innerHTML = '<p>Could not load reviews.</p>';
    return;
    }

    const products = window.__ALL_PRODUCTS__;
    let allReviews = [];
    try {
        // CORRECTED: The API_ROOT variable already contains the customer ID.
        const res = await fetch(`${API_ROOT}/reviews`);
        if (!res.ok) throw new Error('Failed to fetch reviews');
        allReviews = await res.json();
    } catch (e) {
        console.error('Failed to load reviews:', e);
        document.querySelector('#testimonial-slider').innerHTML = '<p>Could not load reviews.</p>';
        return;
    }

    // 2. Group reviews by product and calculate stats
    const reviewsByProduct = {};
    allReviews.forEach(review => {
        const id = review.product_id;
        if (!reviewsByProduct[id]) {
            reviewsByProduct[id] = [];
        }
        reviewsByProduct[id].push(review);
    });

    // 3. Map stats to products and sort
    const ratedProducts = products.map(p => {
        const id = p.product_id ?? p.id;
        const reviewsForThisProduct = reviewsByProduct[id] || [];
        const stats = getReviewStats(reviewsForThisProduct);
        return { ...p, avgRating: stats.avg, reviewCount: stats.count };
    }).filter(p => p.reviewCount > 0) // Only include products that have reviews
      .sort((a, b) => b.avgRating - a.avgRating); // Sort by highest rating

    // 4. Generate HTML for the top 5 rated products
    const topProducts = ratedProducts.slice(0, 5);
    let sliderHtml = '';

    topProducts.forEach(p => {
        const id = p.product_id ?? p.id;
        // Get the first review for this product to display as a sample
        const topReview = (reviewsByProduct[id] || [])[0];

        if (!topReview) return; // Should not happen due to filter, but safe to keep

        const imageUrl = getImageUrl(p);
        const starsHtml = createStars(p.avgRating);
        // CORRECTED: Use 'review' and 'user' to match your data structure.
        const reviewText = topReview.review || 'Loved it!';
        const authorName = topReview.user || 'Verified Customer';

        const productUrl = `product-detail-variable.html?product_id=${encodeURIComponent(id)}&image=${encodeURIComponent(imageUrl)}`;
        sliderHtml += `
            <article class="testimonial top-rated-card">
                <div class="testimonial__img-wrap top-rated-card__media">
                    <img class="testimonial__img" src="${imageUrl}" alt="${p.product_name}">
                </div>
                <div class="top-rated-card__body">
                    <div class="top-rated-card__rating">
                        <div class="top-rated-card__stars">${starsHtml}</div>
                        <span class="top-rated-card__score">${p.avgRating.toFixed(1)}</span>
                        <span class="top-rated-card__count">(${p.reviewCount} review${p.reviewCount === 1 ? '' : 's'})</span>
                    </div>
                    <h3 class="top-rated-card__title">${p.product_name}</h3>
                    <p class="top-rated-card__quote">${reviewText}</p>
                    <span class="top-rated-card__author">${authorName}</span>
                    <div class="top-rated-card__cta">
                        <a class="btn btn--e-brand-b-2" href="${productUrl}">View Product</a>
                    </div>
                </div>
            </article>
        `;
    });
    
    if (!sliderHtml) {
        sliderHtml = '<div class="testimonial" style="text-align:center;"><p>No product reviews found.</p></div>';
    }

    // 5. Inject HTML and Re-initialize Owl Carousel
    const slider = $('#testimonial-slider');
    slider.html(sliderHtml);

    slider.trigger('destroy.owl.carousel');
    slider.owlCarousel({
        items: 1,
        loop: sliderHtml.includes('testimonial__img-wrap'), // Only loop if there are actual reviews
        margin: 30,
        dots: true,
        nav: false,
        autoplay: true,
        autoplayTimeout: 5000,
        autoplayHoverPause: true
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // A short delay to ensure __ALL_PRODUCTS__ is populated by the other script.
    setTimeout(populateTopRatedProducts, 500); 
});
</script>
<script>
    (async () => {
        try {
            const res = await fetch(`${window.API_ROOT}/brand`);
            if (!res.ok) return;
            const brandData = await res.json();
            const texts = brandData.brand_indexPageTexts || {};

            if (Object.keys(texts).length === 0) {
                console.log("No dynamic page texts found.");
                return;
            }

            for (const key in texts) {
                // Find all elements that match the key, not just the first one
                const elements = document.querySelectorAll(`[data-text-key="${key}"]`);
                if (elements.length > 0) {
                    elements.forEach(element => {
                        const value = texts[key];
                        // Check if the value contains line breaks. If so, we need to use innerHTML.
                        if (value.includes('\n')) {
                            // Replace newline characters with <br> tags for HTML rendering
                            element.innerHTML = value.replace(/\n/g, '<br>');
                        } else {
                            // For single-line text, textContent is safer and slightly faster.
                            element.textContent = value;
                        }
                    });
                }
            }
        } catch (error) {
            console.error("Failed to load dynamic page texts:", error);
        }
    })();
</script>
</body>
</html>
